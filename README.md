

### **اپلیکیشن نقاشی فول-استک (Full-Stack)**

این یک اپلیکیشن نقاشی تحت وب است که به کاربران اجازه می‌دهد با استفاده از اشکال مختلف، نقاشی‌های ساده‌ای ایجاد کنند، کار خود را روی سرور ذخیره کرده و بعداً آن را بارگذاری کنند. این تمرین شامل یک فرانت‌اند (Frontend) با React و یک بک‌اند (Backend) با Java Spring Boot است که به پایگاه داده MySQL متصل می‌شود.

-----

### \#\# ویژگی‌ها

  * **احراز هویت کاربر:** یک سیستم ورود ساده با استفاده از کاربران پیش‌فرض (user1, user2).
  * **canvas:** یک فضای اختصاصی برای ایجاد ترکیبات بصری.
  * **shape tools:** افزودن اشکال (دایره، مربع، مثلث) به بوم نقاشی.
  * **کنترل‌های تعاملی:**
      * افزودن اشکال با انتخاب یک ابزار و کلیک روی بوم.
      * کشیدن و رها کردن (Drag and drop) اشکال از نوار ابزار به روی بوم.
      * حذف اشکال با دو بار کلیک روی آن‌ها.
  * **ذخیره‌سازی سمت سرور (Persistence):**
      * ذخیره وضعیت فعلی نقاشی (نام و اشکال) در سرور.
      * بارگذاری نقاشی ذخیره‌شده قبلی کاربر از سرور.
  * **رابط کاربری پویا (Dynamic UI):** رابط کاربری شامل یک هدر با کنترل‌ها، یک فوتر که تعداد هر شکل را به صورت لحظه‌ای نمایش می‌دهد و یک نوار کناری با ابزارهای نقاشی است.

-----

### \#\# Technology Stack

این پروژه با استفاده از یک stack مدرن برای توسعه فرانت‌اند و بک‌اند ساخته شده است.

  * **بک‌اند (Backend):**
      * **Java 17+**
      * **Spring Boot:** برای ساخت API از نوع RESTful.
      * **Spring Data JPA / Hibernate:** برای نگاشت شیء-رابطه‌ای (ORM) و تعامل با پایگاه داده.
      * **Maven:** برای مدیریت وابستگی‌ها و ساخت پروژه.
  * **فرانت‌اند (Frontend):**
      * **React:** برای ساخت رابط کاربری به عنوان یک اپلیکیشن تک‌صفحه‌ای (SPA).
      * **React Context API:** برای مدیریت وضعیت سراسری (global state).
      * **JavaScript**
      * **CSS:** برای استایل‌دهی به اپلیکیشن.
  * **پایگاه داده (Database):**
      * **MySQL:** یک پایگاه داده رابطه‌ای برای ذخیره داده‌های کاربر و نقاشی.

-----

### \#\# معماری

اپلیکیشن از یک معماری کلاسیک کلاینت-سرور (Client-Server) استفاده می‌کند.

  * **فرانت‌اند (کلاینت):** یک اپلیکیشن تک‌صفحه‌ای (SPA) با React که در مرورگر و روی آدرس `http://localhost:3000` اجرا می‌شود. این بخش تمام رندرینگ رابط کاربری و تعاملات کاربر را مدیریت می‌کند. وضعیت (State) از طریق `React Context API (AppContext.js)` مدیریت می‌شود که از `prop-drilling` جلوگیری کرده و یک منبع واحد برای داده‌های اپلیکیشن (مانند کاربر فعلی و اشکال روی بوم) فراهم می‌کند. این بخش با ارسال درخواست‌های REST API با استفاده از `fetch API` با بک‌اند ارتباط برقرار می‌کند.
  * **بک‌اند (سرور):** یک اپلیکیشن Spring Boot که روی `http://localhost:8080` اجرا می‌شود. این بخش به عنوان یک API از نوع RESTful عمل می‌کند که تمام منطق احراز هویت و ذخیره‌سازی را مدیریت می‌کند و نقاط پایانی (endpoints) مشخصی را برای استفاده در طرف  فرانت‌اند ارائه می‌دهد. این سرور بدون حالت (stateless) است و هر درخواست را به طور مستقل پردازش می‌کند.
  * **پایگاه داده:** یک پایگاه داده MySQL که داده‌های اپلیکیشن را ذخیره می‌کند. بک‌اند از `Spring Data JPA` برای map مستقیم اشیاء جاوا (Entities) به جداول پایگاه داده استفاده می‌کند و بسیاری از کدهای تکراری SQL را حذف می‌کند.

-----

### \#\# جزئیات پیاده‌سازی


#### **پیاده‌سازی بک‌اند**

بک‌اند با استفاده از Spring Boot برای ایجاد یک REST API قابل نگهداری ساخته شد.

  * **راه‌اندازی پروژه:** پروژه با استفاده از وب‌سایت **Spring Initializr** (start.spring.io) با key dependenciesهای زیر مقداردهی اولیه شد: `Spring Web`, `Spring Data JPA` و `MySQL Driver`.
  * <img width="1871" height="1029" alt="image" src="https://github.com/user-attachments/assets/cdbdcabd-d766-4a88-a270-997847d2e371" />
  * **پیکربندی پایگاه داده:** اتصال به پایگاه داده MySQL در فایل `src/main/resources/application.properties` پیکربندی شده است. این فایل شامل URL پایگاه داده، نام کاربری و رمز عبور است. ویژگی `spring.jpa.hibernate.ddl-auto=update` به Hibernate دستور می‌دهد تا به طور خودکار schemaی پایگاه داده را بر اساس تعاریف Entityها به‌روزرسانی کند بدون اینکه داده‌ها حذف شوند.
  * **مدل‌سازی داده (JPA Entities):** سه Entity اصلی برای مدل‌سازی داده‌های اپلیکیشن ایجاد شدند. انوتیشن `@Entity` هر کلاس را به عنوان یک JPA entity علامت‌گذاری می‌کند که معادل یک جدول در پایگاه داده است.
      * `User.java`: یک کاربر را با شناسه (`@Id`)، نام کاربری و رمز عبور نمایش می‌دهد.
      * `Drawing.java`: یک بوم نقاشی را نمایش می‌دهد. این کلاس یک رابطه **`@OneToOne`** با `User` دارد که هر نقاشی را به یک کاربر واحد مرتبط می‌کند.
      * `Shape.java`: یک شکل واحد را نمایش می‌دهد. این کلاس یک رابطه **`@ManyToOne`** به Entity `Drawing` دارد، زیرا یک نقاشی می‌تواند شامل چندین شکل باشد. تنظیم `cascade = CascadeType.ALL` روی مجموعه اشکال در Entity `Drawing` تضمین می‌کند که عملیات روی یک نقاشی (مانند ذخیره کردن) به اشکال فرزند آن نیز منتقل شود.
  * **لایه Repository:** برای مدیریت عملیات پایگاه داده، دو اینترفیس Repository ایجاد شد. با ارث‌بری از `JpaRepository`، که مجموعه کاملی از متدهای CRUD (ایجاد، خواندن، به‌روزرسانی، حذف) را بدون نیاز به هیچ کد پیاده‌سازی به ارث می‌برند.
      * `UserRepository.java`: متدهایی برای دسترسی به داده‌های `User` فراهم می‌کند. یک متد کاستوم `findByUsername(String username)` برای جستجوی کاربر بر اساس نام هنگام ورود اضافه کردیم.
      * `DrawingRepository.java`: متدهایی برای دسترسی به داده‌های `Drawing` فراهم می‌کند.
  * **کنترلرهای REST:** دو کنترلر که با انوتیشن `@RestController` مشخص شده‌اند، عملکرد بک‌اند را از طریق نقاط پایانی HTTP در دسترس قرار می‌دهند. انوتیشن `@RequestMapping` مسیر پایه را برای تمام نقاط پایانی درون کنترلر تعیین می‌کند.
      * `UserController.java`: نقاط پایانی مربوط به کاربر را مدیریت می‌کند. این کنترلر شامل نقطه پایانی `POST /api/users/login` است که اطلاعات ورود را دریافت کرده، کاربر را در پایگاه داده پیدا می‌کند و یا کاربر را یا خطای `401 Unauthorized` را برمی‌گرداند.
      * `DrawingController.java`: داده‌های نقاشی را مدیریت می‌کند. این کنترلر `POST /api/drawings/{userId}` برای ذخیره نقاشی و `GET /api/drawings/{userId}` برای بازیابی آن را مدیریت می‌کند.
  * **مدیریت CORS:** هر دو کنترلر با انوتیشن `@CrossOrigin(origins = "http://localhost:3000")` علامت‌گذاری شده‌اند تا به درخواست‌های ارسالی از فرانت‌اند React که روی پورت متفاوتی اجرا می‌شود، اجازه دسترسی دهند.
  * **تزریق داده اولیه (Data Seeding):** یک کامپوننت `DataLoader.java` که `CommandLineRunner` را پیاده‌سازی می‌کند، ایجاد کردیم. متد `run` این کامپوننت در هنگام شروع برنامه اجرا می‌شود. این متد بررسی می‌کند که آیا جدول کاربران خالی است یا خیر و در صورت خالی بودن، آن را با کاربران پیش‌فرض (user1, user2) پر می‌کند.

#### **پیاده‌سازی فرانت‌اند**

فرانت‌اند با استفاده از `Create React App` ساخته شد و به صورت کامپوننت‌های قابل استفاده مجدد سازماندهی شده که در تمرین دوم نیز توضیح دادیم. چون سمت سرور را اضافه کردیم، برخی از بخش‌های فرانت را نیز باید تغییر می‌دادیم (ویژگی ورود به سیستم نیازمند افزودن کامپوننت‌های جدید و تغییر کامپوننت‌های موجود بود. )

  * **`Login.js` (کامپوننت جدید):** این کامپوننت برای ارائه رابط کاربری ورود کاربر اضافه شد. این یک فرم ساده با یک ورودی برای نام کاربری است. از هوک `useState` در React برای مدیریت ورودی فرم و هرگونه پیام خطا استفاده می‌کند. هنگام ارسال فرم، تابع `handleLogin` که از `AppContext` به آن پاس داده شده است را فراخوانی می‌کند.
  * **`AppContext.js` (تغییر یافته):** این فایل هسته وضعیت فرانت‌اند است و برای مدیریت احراز هویت تغییر یافت:
      * **وضعیت `currentUser`:** یک وضعیت جدید، `const [currentUser, setCurrentUser] = useState(null);`، برای ردیابی کاربر وارد شده اضافه کردیم.
      * **تابع `handleLogin`:** این تابع جدید یک نام کاربری دریافت می‌کند، آن را در یک درخواست `POST` به نقطه پایانی `/api/users/login` بک‌اند ارسال می‌کند و در صورت دریافت پاسخ موفق، وضعیت `currentUser` را با داده‌های کاربر به‌روز می‌کند.
      * **تابع `handleLogout`:** این تابع وضعیت `currentUser` را به `null` تغییر می‌دهد، که کاربر را از سیستم خارج کرده و او را به صفحه login برمی‌گرداند.
      * **توابع `handleSave` و `handleFetch`:** این توابع برای استفاده از `currentUser.id` از وضعیت تغییر دادیم. این کار تضمین می‌کند که کاربران فقط می‌توانند نقاشی‌های خود را ذخیره و بارگذاری کنند.
  * **`App.js` (تغییر یافته):** این کامپوننت برای مدیریت نمایش بر اساس وضعیت احراز هویت تغییر دادیم. از یک ساب کامپوننت به نام  `AppContent` استفاده می‌کند که به `currentUser` از `context` دسترسی دارد. اگر `currentUser` برابر با `null` باشد، کامپوننت `Login` را نمایش می‌دهد، در غیر این صورت، اپلیکیشن اصلی نقاشی را نمایش می‌دهد.
  * **`Header.js` (تغییر یافته):** هدر برای آگاهی از کاربر وارد شده به‌روزرسانی کردیم. یک پیام "Welcome, [username]" (خوش آمدید، [نام کاربری]) نمایش می‌دهد و شامل یک دکمه "Logout" (خروج) است که تابع `handleLogout` را از `context` فراخوانی می‌کند.

-----

### \#\# نحوه اجرای پروژه

برای اجرای این پروژه به صورت لوکال، از Java، Maven، Node.js و MySQL استفاده می‌کنیم.

#### **پیش‌نیازها**

  * Java (JDK 17 یا جدیدتر)
  * Apache Maven
  * Node.js و npm
  * MySQL Server

#### **۱. راه‌اندازی بک‌اند**

  * **ایجاد پایگاه داده:** کلاینت MySQL را باز کردیم و یک پایگاه داده جدید برای اپلیکیشن ایجاد کردیم.
    ```sql
    CREATE DATABASE drawing_app_db;
    ```
    <img width="1920" height="1080" alt="image" src="https://github.com/user-attachments/assets/fbefd793-9f78-4d59-91ef-9ec73b1b7041" />

  * **پیکربندی اطلاعات اتصال:** به پوشه پروژه بک‌اند (`drawing-app/`) می‌رویم و فایل `src/main/resources/application.properties` را باز می‌کنیم. URL پایگاه داده، نام کاربری و رمز عبور را با اطلاعات اتصال MySQL خود به‌روزرسانی می‌کنیم.
  * **اجرای سرور:** یک ترمینال در دابرکتوری پروژه بک‌اند (`drawing-app/`) باز کرده و دستور زیر را اجرا می‌کنیم:
    ```bash
    ./mvnw spring-boot:run
    ```
    سرور روی `http://localhost:8080` شروع به کار خواهد کرد.

#### **۲. راه‌اندازی فرانت‌اند**

  * **نصب Dependencies:** یک ترمینال جدید باز می‌کنیم و به دابرکتوری پروژه فرانت‌اند (`my-drawing-app/`) می‌رویم. دستور زیر را برای نصب پکیج‌های مورد نیاز اجرا می‌کنیم:
    ```bash
    npm install
    ```
  * **اجرای اپلیکیشن:** پس از اتمام نصب، سرور توسعه React را شروع می‌کنیم:
    ```bash
    npm start
    ```

#### **۳. دسترسی به اپلیکیشن**

فرانت‌اند به طور خودکار در مرورگر در آدرس `http://localhost:3000` باز خواهد شد. می‌توانیم با یکی از کاربران پیش‌فرض (`user1` یا `user2`) وارد شویم و شروع به نقاشی کنیم.
